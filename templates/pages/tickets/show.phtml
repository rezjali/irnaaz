<div class="max-w-4xl mx-auto">
    <!-- Ticket Header -->
    <div class="bg-white p-6 rounded-xl shadow-md mb-6">
        <div class="flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-semibold text-gray-800"><?php echo e($ticket->subject); ?></h2>
                <p class="text-sm text-gray-500 mt-1">
                    ایجاد شده توسط: <?php echo e($ticket->user_name); ?> در تاریخ <?php echo jdate('Y/m/d H:i', strtotime($ticket->created_at)); ?>
                </p>
            </div>
            <div>
                <?php 
                    $statusClass = 'bg-gray-100 text-gray-800';
                    if ($ticket->status === 'open') $statusClass = 'bg-green-100 text-green-800';
                    if ($ticket->status === 'answered') $statusClass = 'bg-blue-100 text-blue-800';
                    if ($ticket->status === 'closed') $statusClass = 'bg-red-100 text-red-800';
                    $statusText = ['open' => 'باز', 'answered' => 'پاسخ داده شده', 'closed' => 'بسته شده'];
                ?>
                <span class="text-sm font-bold px-4 py-2 rounded-full <?php echo $statusClass; ?>">
                    <?php echo $statusText[$ticket->status] ?? e($ticket->status); ?>
                </span>
            </div>
        </div>
    </div>

    <!-- Replies -->
    <div class="space-y-6">
        <?php foreach ($replies as $reply): ?>
            <?php
                // role_id = 1 is super_admin
                $is_admin_reply = $reply->role_id == 1 || $reply->role_id == 3;
                $reply_bg_class = $is_admin_reply ? 'bg-blue-50 border-r-4 border-blue-500' : 'bg-gray-50 border-r-4 border-gray-400';
            ?>
            <div class="bg-white p-5 rounded-lg shadow-sm <?php echo $reply_bg_class; ?>">
                <div class="flex justify-between items-center mb-2">
                    <p class="font-semibold <?php echo $is_admin_reply ? 'text-blue-700' : 'text-gray-800'; ?>">
                        <?php echo e($reply->replier_name); ?>
                        <?php if ($is_admin_reply): ?> <span class="text-xs text-white bg-blue-600 px-2 py-0.5 rounded-full">پشتیبانی</span> <?php endif; ?>
                    </p>
                    <p class="text-xs text-gray-500"><?php echo jdate('l j F Y - H:i', strtotime($reply->created_at)); ?></p>
                </div>
                <div class="text-gray-700 leading-relaxed">
                    <?php echo nl2br(e($reply->message)); ?>
                </div>
            </div>
        <?php endforeach; ?>
    </div>

    <!-- New Reply Form -->
    <div class="bg-white p-6 rounded-xl shadow-md mt-8">
        <h3 class="text-lg font-semibold mb-4">ارسال پاسخ جدید</h3>
        <form action="<?php echo APP_URL; ?>/tickets/reply" method="POST">
            <input type="hidden" name="ticket_id" value="<?php echo e($ticket->id); ?>">
            <div>
                <textarea name="message" rows="6" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="پاسخ خود را اینجا بنویسید..."></textarea>
            </div>
            <div class="mt-4 flex justify-end">
                <button type="submit" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700">ارسال پاسخ</button>
            </div>
        </form>
    </div>
</div>
